<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Surveillance CCTV - Tactical Hack</title>
    <style>
        body { background: #050505; color: #00ff00; font-family: 'Courier New', monospace; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; margin: 0; }
        #game-screen { position: relative; width: 700px; background: #111; border: 4px solid #333; }
        #monitor { width: 100%; height: 350px; background: #000; overflow: hidden; position: relative; border-bottom: 4px solid #333; }
        #watcher-img { width: 100%; height: 100%; object-fit: cover; }
        .away { filter: grayscale(1) brightness(0.2); opacity: 0.5; }
        #mission-status { position: absolute; top: 10px; left: 10px; background: rgba(0,0,0,0.8); padding: 10px; border: 1px solid #0f0; }
        .check-dot { display: inline-block; width: 12px; height: 12px; border: 1px solid #0f0; margin-right: 4px; border-radius: 2px; }
        .done { background: #0f0; box-shadow: 0 0 5px #0f0; }
        #ui-panel { display: flex; padding: 20px; gap: 15px; background: #1a1a1a; height: 250px; }
        .hack-container { flex-grow: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; border-left: 1px solid #333; padding-left: 15px; }
        #quiz-box { width: 100%; text-align: center; display: none; background: #000; padding: 20px; border: 1px solid #0f0; }
        #hold-btn { width: 120px; height: 120px; border-radius: 60px; border: 5px solid #0f0; background: none; color: #0f0; cursor: pointer; user-select: none; }
        #hold-btn:active { background: #030; }
        #overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); display: none; flex-direction: column; align-items: center; justify-content: center; z-index: 100; }
        #overlay img { width: 70%; border: 4px solid red; margin-bottom: 20px; }
    </style>
</head>
<body>

    <div id="game-screen">
        <div id="monitor">
            <img id="watcher-img" src="1.png">
            <div id="mission-status">
                <div>MISSION: <span id="mission-count">0</span> / 10</div>
                <div id="check-container" style="margin-top:5px;"></div>
            </div>
            <div id="timer-display" style="position:absolute; top:10px; right:10px;">
                <span id="state-label">감시 중</span> (<span id="cycle-timer">15</span>s)
            </div>
        </div>

        <div id="ui-panel">
            <div class="hack-container">
                <button id="start-hack-btn" onclick="openHackConsole()" style="width:100%; height:100px; background:#020; color:#0f0; border:2px solid #0f0; cursor:pointer;">터미널 접속</button>
                <div id="quiz-box">
                    <div id="math-ui">
                        <div id="quiz-question" style="font-size:24px; color:#ff0; margin-bottom:10px;"></div>
                        <input type="number" id="quiz-input" onkeydown="handleMathInput(event)" style="background:#000; border:1px solid #0f0; color:#0f0; font-size:24px; width:100px; text-align:center;">
                    </div>
                    <div id="hold-ui" style="display:none;">
                        <div style="margin-bottom:10px;">데이터 추출 (2초간 꾹 누르세요)</div>
                        <button id="hold-btn" onmousedown="startHold()" onmouseup="endHold()" onmouseleave="endHold()">HOLD</button>
                    </div>
                    <div style="font-size:10px; color:red; margin-top:10px;">[ESC] 로그아웃</div>
                </div>
            </div>
        </div>

        <div id="overlay">
            <h1 id="res-title" style="color:red;">TERMINATED</h1>
            <img id="res-img" src="">
            <button onclick="restartGame()" style="padding:10px 20px; background:#0f0; border:none; cursor:pointer; font-weight:bold;">새로운 세션 시작</button>
        </div>
    </div>

    <script>
        let isAway = false, missionDone = 0, timeLeft = 15;
        let isHackingMode = false, currentWatcher = 1;
        let currentAns = 0, holdTimer = null;

        function init() {
            const container = document.getElementById('check-container');
            container.innerHTML = "";
            for(let i=0; i<10; i++) {
                const dot = document.createElement('div');
                dot.className = 'check-dot';
                dot.id = 'dot-' + i;
                container.appendChild(dot);
            }
            document.getElementById('watcher-img').src = (currentWatcher === 1) ? "1.png" : "4.png";
        }

        setInterval(() => {
            if(document.getElementById('overlay').style.display === "flex") return;
            timeLeft--;
            if(timeLeft <= 0) {
                isAway = !isAway;
                timeLeft = isAway ? 10 : 15;
                updateUI();
            }
            document.getElementById('cycle-timer').innerText = timeLeft;
        }, 1000);

        function updateUI() {
            const watcherImg = document.getElementById('watcher-img');
            const stateLabel = document.getElementById('state-label');
            if(isAway) {
                watcherImg.classList.add('away');
                stateLabel.innerText = "자리 비움"; stateLabel.style.color = "#0f0";
                document.getElementById('start-hack-btn').disabled = false;
            } else {
                watcherImg.classList.remove('away');
                stateLabel.innerText = "감시 중"; stateLabel.style.color = "red";
                document.getElementById('start-hack-btn').disabled = true;
                watcherImg.src = (currentWatcher === 1) ? "1.png" : "4.png";
                if(isHackingMode) gameOver();
            }
        }

        function openHackConsole() {
            if(!isAway) return;
            isHackingMode = true;
            document.getElementById('start-hack-btn').style.display = 'none';
            document.getElementById('quiz-box').style.display = 'block';
            
            // 감시자에 따른 문제 유형 교체
            if(currentWatcher === 1) {
                document.getElementById('math-ui').style.display = 'block';
                document.getElementById('hold-ui').style.display = 'none';
                makeMathQuiz();
            } else {
                document.getElementById('math-ui').style.display = 'none';
                document.getElementById('hold-ui').style.display = 'block';
            }
        }

        // --- 문제 유형 1: 수학 ---
        function makeMathQuiz() {
            const n1 = Math.floor(Math.random()*9)+1, n2 = Math.floor(Math.random()*9)+1;
            currentAns = n1 + n2;
            document.getElementById('quiz-question').innerText = `${n1} + ${n2} = ?`;
            document.getElementById('quiz-input').value = ""; document.getElementById('quiz-input').focus();
        }
        function handleMathInput(e) {
            if(e.key === 'Enter') {
                if(parseInt(document.getElementById('quiz-input').value) === currentAns) successOne();
            }
        }

        // --- 문제 유형 2: 홀드 버튼 ---
        function startHold() {
            holdTimer = setTimeout(() => { successOne(); endHold(); }, 2000); // 2초 유지
        }
        function endHold() { clearTimeout(holdTimer); }

        function successOne() {
            missionDone++;
            document.getElementById('mission-count').innerText = missionDone;
            document.getElementById('dot-' + (missionDone-1)).classList.add('done');
            if(missionDone >= 10) { alert("완료!"); restartGame(); }
            else if(currentWatcher === 1) makeMathQuiz();
        }

        function gameOver() {
            isHackingMode = false;
            document.getElementById('overlay').style.display = "flex";
            const resImg = document.getElementById('res-img');
            
            if(currentWatcher === 1) {
                resImg.src = "3.png"; // 할아버지 1 목 떨어짐
                currentWatcher = 2;
            } else {
                resImg.src = "6.png"; // 할아버지 2 목 떨어짐
                currentWatcher = 1;
            }
            missionDone = 0; // 리셋
            init();
        }

        function restartGame() {
            document.getElementById('overlay').style.display = "none";
            isAway = false; timeLeft = 15;
            closeHackConsole();
            updateUI();
        }

        function closeHackConsole() {
            isHackingMode = false;
            document.getElementById('start-hack-btn').style.display = 'block';
            document.getElementById('quiz-box').style.display = 'none';
        }

        window.addEventListener('keydown', (e) => { if(e.key === 'Escape') closeHackConsole(); });
        window.onload = init;
    </script>
</body>
</html>
