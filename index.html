<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Surveillance CCTV Escape - 10s Window</title>
    <style>
        body { background: #050505; color: #00ff00; font-family: 'Courier New', monospace; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; margin: 0; }
        #game-screen { position: relative; width: 600px; background: #111; border: 4px solid #333; box-shadow: 0 0 20px rgba(0,255,0,0.2); }
        
        /* ìƒë‹¨ ëª¨ë‹ˆí„° */
        #monitor { width: 100%; height: 350px; background: #000; overflow: hidden; position: relative; border-bottom: 4px solid #333; }
        #watcher-img { width: 100%; height: 100%; object-fit: cover; transition: 0.3s; }
        .away { filter: grayscale(1) brightness(0.2); opacity: 0.5; }
        
        /* ìƒíƒœ íƒ€ì´ë¨¸ */
        #timer-display { position: absolute; top: 10px; right: 10px; font-size: 14px; background: rgba(0,0,0,0.8); padding: 5px 10px; border: 1px solid #0f0; border-radius: 5px; }

        /* í•˜ë‹¨ UI */
        #ui-panel { display: flex; padding: 20px; gap: 20px; background: #1a1a1a; }
        .keypad-container { width: 140px; }
        #phone-display { background: #000; padding: 5px; text-align: center; border: 1px solid #0f0; height: 20px; margin-bottom: 5px; font-weight: bold; }
        .keypad { display: grid; grid-template-columns: repeat(3, 1fr); gap: 5px; }
        .key { padding: 10px; background: #333; border: 1px solid #555; color: #0f0; cursor: pointer; text-align: center; }
        .key:active { background: #0f0; color: #000; }

        /* í•´í‚¹ êµ¬ì—­ */
        .hack-container { flex-grow: 1; display: flex; flex-direction: column; align-items: center; }
        #hack-btn { width: 100%; height: 80px; background: #020; border: 2px solid #0f0; color: #0f0; font-weight: bold; cursor: pointer; font-size: 16px; }
        #hack-btn:disabled { border-color: #444; color: #444; cursor: not-allowed; }
        .progress-box { width: 100%; height: 25px; border: 1px solid #0f0; margin: 15px 0; position: relative; background: #000; }
        #progress-fill { width: 0%; height: 100%; background: #0f0; transition: 0.1s; }
        #status-text { font-size: 12px; color: #ff0; text-align: center; height: 15px; }

        /* ê²°ê³¼ í™”ë©´ */
        #overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); display: none; flex-direction: column; align-items: center; justify-content: center; z-index: 100; text-align: center; }
        #overlay img { width: 80%; border: 4px solid red; margin-bottom: 20px; }
        #overlay h1 { color: red; margin: 0 0 20px 0; }
        .retry-btn { padding: 10px 30px; background: #0f0; border: none; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>

    <div style="margin-bottom: 15px; text-align: center;">
        <strong>[15ì´ˆ ê°ì‹œ / 10ì´ˆ ê³µë°± ì‹œìŠ¤í…œ]</strong><br>
        ê°ì‹œìê°€ ì „í™”ë¥¼ ë°›ê±°ë‚˜ í•œëˆˆì„ íŒŒëŠ” 10ì´ˆë¥¼ ë…¸ë¦¬ì„¸ìš”!
    </div>

    <div id="game-screen">
        <div id="monitor">
            <img id="watcher-img" src="1.png">
            <div id="timer-display">ìƒíƒœ: <span id="state-label">ê°ì‹œ ì¤‘</span> (<span id="cycle-timer">15</span>s)</div>
        </div>

        <div id="ui-panel">
            <div class="keypad-container">
                <div id="phone-display">---</div>
                <div class="keypad">
                    <div class="key" onclick="press('1')">1</div><div class="key" onclick="press('2')">2</div><div class="key" onclick="press('3')">3</div>
                    <div class="key" onclick="press('4')">4</div><div class="key" onclick="press('5')">5</div><div class="key" onclick="press('6')">6</div>
                    <div class="key" onclick="press('7')">7</div><div class="key" onclick="press('8')">8</div><div class="key" onclick="press('9')">9</div>
                    <div class="key" onclick="clearKey()">C</div><div class="key" onclick="press('0')">0</div><div class="key" onclick="dial()">ğŸ“</div>
                </div>
            </div>

            <div class="hack-container">
                <div id="status-text">ê°ì‹œìê°€ ëª¨ë‹ˆí„°ë§ ì¤‘ì…ë‹ˆë‹¤.</div>
                <div class="progress-box"><div id="progress-fill"></div></div>
                <button id="hack-btn" onmousedown="startHack()" onmouseup="stopHack()" onmouseleave="stopHack()" disabled>ë°©í™”ë²½ í•´ì œ ë²„íŠ¼ (HOLD)</button>
            </div>
        </div>

        <div id="overlay">
            <h1 id="res-title">ë”± ê±¸ë ¸ì–´!</h1>
            <img id="res-img" src="2.png">
            <button class="retry-btn" onclick="location.reload()">ë‹¤ì‹œ ì‹œì‘</button>
        </div>
    </div>

    <script>
        let isAway = false;
        let progress = 0;
        let dialStr = "";
        let hackInterval;
        let timeLeft = 15; // ì´ˆê¸° ê°ì‹œ ì‹œê°„
        let isPhoneLured = false;

        const watcherImg = document.getElementById('watcher-img');
        const hackBtn = document.getElementById('hack-btn');
        const progressFill = document.getElementById('progress-fill');
        const statusText = document.getElementById('status-text');
        const cycleTimerText = document.getElementById('cycle-timer');
        const stateLabel = document.getElementById('state-label');

        // ë©”ì¸ íƒ€ì´ë¨¸ ë£¨í”„
        function gameTimer() {
            setInterval(() => {
                if (isPhoneLured) return; // ì „í™” ìœ ì¸ ì¤‘ì—ëŠ” ìë™ íƒ€ì´ë¨¸ ì¤‘ì§€

                timeLeft--;
                
                if (timeLeft <= 0) {
                    if (!isAway) {
                        // ê°ì‹œ -> ìë¦¬ë¹„ì›€ (10ì´ˆ)
                        triggerAway(10);
                    } else {
                        // ìë¦¬ë¹„ì›€ -> ê°ì‹œ (15ì´ˆ)
                        triggerWatch(15);
                    }
                }
                cycleTimerText.innerText = timeLeft;
            }, 1000);
        }

        function triggerAway(duration) {
            isAway = true;
            timeLeft = duration;
            stateLabel.innerText = "ìë¦¬ ë¹„ì›€";
            stateLabel.style.color = "#0f0";
            watcherImg.classList.add('away');
            hackBtn.disabled = false;
            statusText.innerText = "ê°ì‹œìê°€ ìë¦¬ë¥¼ ë¹„ì› ìŠµë‹ˆë‹¤! í•´í‚¹ ê°€ëŠ¥!";
        }

        function triggerWatch(duration) {
            isAway = false;
            isPhoneLured = false;
            timeLeft = duration;
            stateLabel.innerText = "ê°ì‹œ ì¤‘";
            stateLabel.style.color = "red";
            watcherImg.classList.remove('away');
            hackBtn.disabled = true;
            statusText.innerText = "ê°ì‹œìê°€ ëŒì•„ì™”ìŠµë‹ˆë‹¤! ë©ˆì¶”ì„¸ìš”!";
            if(progress > 0) checkDetection();
        }

        function dial() {
            if(dialStr === "486") {
                isPhoneLured = true;
                triggerAway(10); // ì „í™” ìœ ì¸ ì‹œì—ë„ 10ì´ˆê°„ ìë¦¬ë¥¼ ë¹„ì›€
                clearKey();
            } else {
                alert("ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
                clearKey();
            }
        }

        function press(n) { if(dialStr.length < 3) dialStr += n; updateDisplay(); }
        function clearKey() { dialStr = ""; updateDisplay(); }
        function updateDisplay() { document.getElementById('phone-display').innerText = dialStr || "---"; }

        function startHack() {
            if(!isAway) { gameOver(); return; }
            hackInterval = setInterval(() => {
                progress += 0.5;
                progressFill.style.width = progress + "%";
                if(progress >= 100) { clearInterval(hackInterval); win(); }
            }, 50);
        }

        function stopHack() { clearInterval(hackInterval); }

        function checkDetection() {
            if(!isAway && progress > 0) gameOver();
        }

        function gameOver() {
            stopHack();
            document.getElementById('overlay').style.display = "flex";
            document.getElementById('res-img').src = "2.png";
        }

        function win() {
            document.getElementById('overlay').style.display = "flex";
            document.getElementById('res-title').innerText = "í•´í‚¹ ì„±ê³µ! íƒˆì¶œ ì™„ë£Œ!";
            document.getElementById('res-title').style.color = "#0f0";
            document.getElementById('res-img').src = "1.png";
        }

        gameTimer();
    </script>
</body>
</html>
